@using Domain.Api.Schedule
@using (var template = Html.Incoding().Template<GetClassByWeekQuery.Response>())
{
    using (var each = template.ForEach())
    {
        <div class="h-100 bg-light rounded class-card d-flex flex-column shadow shadow-hover cursor-grab" role="drag-element" name="card">
            @Html.Hidden(nameof(SaveScheduleCommand.DisciplinePlanId), each.For(r => r.DisciplinePlanId))
            @Html.Hidden(nameof(SaveScheduleCommand.SubGroupNo), each.For(r => r.SubGroupNo))

            <div class="w-100 rounded-top flex-shrink-0" style="height: 0.25rem; background-color: @each.For(r => r.Color)"></div>

            <div class="d-flex mx-1 mt-1 gap-2">
                <div class="flex-grow-1 discipline-code" title="@each.For(r => r.Discipline)">
                    @each.For(r => r.DisciplineCode)
                </div>
                <div class="flex-grow-1 discipline text-nowrap text-overflow-elipsis overflow-hidden" title="@each.For(r => r.Discipline)">
                    @each.For(r => r.Discipline)
                </div>

                <div class="flex-shrink-0 subdiscipline-code" title="@each.For(r => r.SubDiscipline)">
                    @each.For(r => r.SubDisciplineCode)
                </div>
                <div class="flex-shrink-0 subdiscipline" title="@each.For(r => r.SubDiscipline)">
                    @each.For(r => r.SubDiscipline)
                </div>
            </div>

            <div class="mx-1">
                @each.Inline(r => r.HasSubGroups,
                             @<text>
                                 @each.For(r => r.SubGroupNo) @DataResources.SubGroup
                              </text>,
                             @<text>
                                 -
                              </text>)
            </div>

            <div class="d-flex mx-1">
                <div class="flex-grow-1">
                    @each.For(r => r.Teacher)
                </div>
                <div class="flex-shrink-0" title="@each.For(r => r.Department)">
                    @each.For(r => r.DepartmentCode)
                </div>
            </div>

            @Html.Hidden(nameof(SaveScheduleCommand.AuditoriumId))

            @{
                var auditoriumTextId = $"auditorium-{each.For(r => r.DisciplineId)}-{each.For(r => r.DisciplinePlanId)}-{each.For(r => r.SubDisciplineId)}";
            }

            @await Html.PartialAsync("~/Views/Shared/DropDown_Tmpl.cshtml", new DropdownModel
                   {
                       Button = new DropdownModel.ButtonSettings
                       {
                           Classes = "w-100 btn-light btn-sm",
                           Text = DataResources.ChooseAuditorium,
                           Id = auditoriumTextId
                       },
                       Items = new List<IHtmlContent>
                       {
                           Html.Controls().Dropdown.List(settings =>
                           {
                               settings.Url = Url.Dispatcher().Query<GetAuditoriumsForDDQuery>().AsJson();
                               settings.OnClick = dsl =>
                               {
                                   dsl.WithId(auditoriumTextId).Insert.Use(Selector.Event.Data.For("text")).Html();
                                   dsl.WithSelf(r => r.Closest(q => q.Name("card")).Find(q => q.Name<SaveScheduleCommand>(w => w.AuditoriumId)))
                                      .JQuery.Attr.Val(Selector.Event.Data.For("value"));
                                   dsl.WithSelf(r => r.Closest(q => q.Name("cell")))
                                      .Trigger.None();
                               };
                           })
                       },
                       Classes = "mx-1 mb-1"
                   })
        </div>
    }
}
